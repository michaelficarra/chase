\section{The Chase}
\label{sec:chase}

	The \emph{chase} is a function that, when given a geometric theory, will
	generate a model in the set of jointly universal models for that theory. More
	specifically, if $\mathcal{U}$ is the set of all models obtained from an
	execution of the chase over a geometric theory $T$, for any model
	$\mathbb{M}$ such that $\mathbb{M} \models T$, there is a homomorphism from
	some model $\mathbb{U} \in \mathcal{U}$ to $\mathbb{M}$. Note that given a
	model $\mathbb{M}$ returned by the chase there may exist a model
	$\mathbb{N}$ such that $\mathbb{N} \preceq \mathbb{M}$.

	Verifying the universality of a model or the joint universality of a set of
	models requires checking if a homomorphism exists from the universal model(s)
	to each of the infinite set of all models that satisfy the theory. It may
	not at first seem obvious that generating a universal model would be a
	computable task, but it will be shown that the chase is able to do this,
	and it will be proven that the models it returns during successful runs are
	in fact members of a set of jointly universal models.

	Geometric logic formul{\ae} are used by the chase both because they are
	natural expressions of many common applications and because they take
	advantage of the useful properties of the positive-existential formul{\ae}
	of which they are constructed. Recall that, when adding any relations or
	domain members to a model that satisfies a positive-existential formula,
	the model will always satisfy the formula. This is particularly helpful
	when trying to create a model that satisfies all formul{\ae} in a geometric
	theory.

	\textbf{ I should probably talk about fairness here, I'm just not exactly sure where }

	\subsection{Algorithm}
	\label{sec:chase.algorithm}

		The chase starts with an input theory $T$ and a model $\mathbb{M}$ that
		has an empty domain and an empty set of facts.

		\textbf{ I need this thoroughly checked for correctness }

		\begin{algorithm}[H]
		\DontPrintSemicolon
		\TitleOfAlgo{The Chase}
		\While{$\exists$ a formula $\sigma \in T$ and an environment $\lambda$ such that $\mathbb{M} \not\models_\lambda \sigma$}{
			let $\sigma$ be $\alpha \to \beta$ \;
			\lIf{$\beta = \bot$}{
				halt with a failure \;
			}
			\lIf{$\beta$ contains a disjunction}{
				choose a disjunct $\delta$ and redefine $\beta$ as $\delta$ \;
			}
			\ForAll{variables $v \in free(\beta)$ for which $\lambda$ is undefined}{
				add a new domain member $\omega$ such that $\omega \not\in |\mathbb{M}|$ to $|\mathbb{M}|$ \;
				redefine $\lambda$ as $\lambda_{v \mapsto \omega}$ \;
			}
			\ForAll{relations $R(\alpha_0,\ldots,\alpha_n) \in \mathbb{M}$}{
				replace each variable $\alpha_i \in \{\alpha_0,\ldots,\alpha_n\}$ with $\lambda(\alpha_i)$ \;
			}
		}
		halt with result $\mathbb{M}$ \;
		\end{algorithm}

		\textbf{Is what I have only applicable to a $\beta$ that is a single
		atomic? Do I have to recursively call $chase$ or call a helper for
		conjunctions and handle equality like I do in the implementation?
		Modify $\lambda$ for existential quantifiers like in the implementation
		too?}

		There are three types of runs of the chase:
		\begin{itemize}
		\item a set of jointly universal models is found in finite time
		\item an empty result is found in finite time
		\item an infinite run with possible return dependent on implementation
		\end{itemize}

	\subsection{Examples}

		Define $\Sigma$ as the following geometric theory.

		\begin{eqnarray}
			\label{eqn:chase1}
			\top    &  \to  &  \exists\ x,y : R(x,y)                             \\
			\label{eqn:chase2}
			R(x,y)  &  \to  &  (\exists\ z : Q(x,z)) \vee P                      \\
			\label{eqn:chase3}
			Q(x,y)  &  \to  &  (\exists\ z : R(x,z)) \vee (\exists\ z : R(z,y))  \\
			\label{eqn:chase4}
			P       &  \to  &  \bot
		\end{eqnarray}

		The following three chase runs show the different types of results
		depending on which disjunct the algorithm attempts to satisfy when a
		disjunction is encountered.

		\begin{enumerate}
		\item A non-empty result in finite time:

			\begin{tabular}{lllllll}
				$\emptyset$ & $\mapsto$ & \{ & $a,b$   & $|$ & $R(a,b)$         & \} \\
				{}          & $\mapsto$ & \{ & $a,b,c$ & $|$ & $R(a,b), Q(a,c)$ & \}
			\end{tabular}

			Since the left side of \eqref{eqn:chase1} is always satisfied, but
			its right side is not, domain members $a$ and $b$ and fact $R(a,b)$
			are added to the initially empty model to satisfy \eqref{eqn:chase1}.
			The left side of \eqref{eqn:chase2} holds, but the right side does
			not, so one of the disjuncts $\exists\ z : Q(x,z)$ or $P(x)$ is
			chosen to be satisfied. Assuming the left operand is chosen, $x$
			will already have been assigned to $a$ and a new domain member $c$
			and a new fact $Q(a,c)$ will be added to satisfy \eqref{eqn:chase2}.
			With the current model, all rules hold under any environment.
			Therefore, this model is universal.

		\item An empty result in finite time:

			\begin{tabular}{lllllll}
				$\emptyset$ & $\mapsto$ & \{ & $a,b$   & $|$ & $R(a,b)$               & \} \\
				{}          & $\mapsto$ & \{ & $a,b,c$ & $|$ & $R(a,b), P(a,c)$       & \} \\
				{}          & $\mapsto$ & \{ & $a,b,c$ & $|$ & $R(a,b), P(a,c), \bot$ & \} \\
				{}          & $\mapsto$ & \multicolumn{5}{l}{ $\varepsilon$ }
			\end{tabular}

			Again, domain members $a$ and $c$ and fact $R(a,b)$ are added to
			the initial model to satisfy \eqref{eqn:chase1}. This time, when
			attempting to satisfy \eqref{eqn:chase2}, the right side is chosen
			and $P$ is added to the set of facts. After adding this new fact,
			rule \eqref{eqn:chase4} no longer holds; its left side is
			satisfied, but its right side does not hold for all of the bindings
			for which it is satisfied. When we attempt to satisfy the right
			side of \eqref{eqn:chase4}, it is found to be a contradiction and
			therefore unsatisfiable. Since this model can never satisfy this
			theory, the chase fails.

		\item An infinite run:

			\begin{tabular}{lllllll}
				$\emptyset$ & $\mapsto$ & \{ & $a,b$        & $|$ & $R(a,b)$                                 & \} \\
				{}          & $\mapsto$ & \{ & $a,b,c$      & $|$ & $R(a,b), Q(a,c)$                         & \} \\
				{}          & $\mapsto$ & \{ & $a,\ldots,d$ & $|$ & $R(a,b), Q(a,c), R(d,c)$                 & \} \\
				{}          & $\mapsto$ & \{ & $a,\ldots,e$ & $|$ & $R(a,b), Q(a,c), R(d,c), Q(d,e)$         & \} \\
				{}          & $\mapsto$ & \{ & $a,\ldots,f$ & $|$ & $R(a,b), Q(a,c), R(d,c), Q(d,e), R(f,e)$ & \} \\
				{}          & $\mapsto$ & \multicolumn{5}{l}{ $\ldots$ }
			\end{tabular}

			Like in the example above that returned a non-empty, finite result,
			the first two steps add domain members $a$, $b$, and $c$ and facts
			$R(a,b)$ and $Q(a,c)$. The left side of the implication in
			\eqref{eqn:chase3} now holds, but the right side does not. In order
			to make the right side hold, one of the disjuncts needs to be
			satisfied. If the right disjunct is chosen, a new domain member $d$
			and a new relation $R(d,c)$ will be added. This will cause the left
			side of the implication in \eqref{eqn:chase2} to hold for $R(d,c)$,
			but the right side will not hold for the same binding. $Q(d,e)$
			will be added, and this loop will continue indefinitely unless a
			different disjunct is chosen in \eqref{eqn:chase2} or
			\eqref{eqn:chase3}.

		\end{enumerate}

	\subsection{Properties of the Chase}

		%\begin{theorem}
		%	A geometric theory $T$ is satisfiable if and only if either there
		%	exists an infinite fair chase run of $T$ or there exists a
		%	successful fair chase run of $T$.
		%\end{theorem}

		%\begin{proof}
		%\end{proof}

		\label{fairness_definition}
		\begin{description}
		\item [Fairness] A deterministic realization of the chase algorithm
		(the pair of the chase and an evaluation strategy) is \emph{fair} if
		there is no opportunity for a formula, binding, or \textbf{...} to go
		unevaluated during an infinite run.
		\end{description}

		\textbf{how about order of conjunction evaluation? that must cause an unfair chase}

		\textbf{also, this is quite an unclear description and should be reworded with help from dd}

		\begin{theorem}
			Let $T$ be a geometric theory. For any model $\mathbb{M}$ such that
			$\mathbb{M} \models T$, there exists a run of the chase that
			returns a model $\mathbb{N}$ such that $\mathbb{N} \models T$ and
			$\mathbb{N} \preceq \mathbb{M}$.
		\end{theorem}

		\begin{proof}
		\end{proof}

	\subsection{History}

		In \cite{FKMP02} \emph{Data Exchange: Semantics and Query Answering},
		Fagin et. al. first introduce a chase algorithm. The version they
		defined disallows disjunctions and, because of that, is limited in its
		utility. Input formul{\ae} without disjunctions are not as expressive
		as geometric formul{\ae} and have fewer applications. It is, however, a
		completely deterministic algorithm.

		The chase was originally used to solve the problem of data exchange. As
		Fagin et al. states, ``Data exchange is the problem of taking data
		structured under a source schema and creating an instance of a target
		schema that reflects the source data as accurately as possible". The
		solution to the stated problem was to find a universal model. In theories
		without disjunction, a single universal model exists that has a
		homomorphism to any other model that satisfies the theory. This
		absolute universal model can be calculated from a single run of their
		deterministic chase algorithm.

		The definition of the chase algorithm used by Fagin et. al. is similar
		to the one defined in section \ref{sec:chase.algorithm} in all ways
		except that it does not have to choose a disjunct.
